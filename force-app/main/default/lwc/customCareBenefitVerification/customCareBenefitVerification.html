<template>
  <div class="slds-container">
    Record Id: {recordId}

    <div class="slds-grid slds-gutters">
      <div class="slds-col slds-size_1-of-3">
        <!-- Available Plans Section -->
        <template if:true={showMemPlan}>
          <section class="slds-section plans-section">
            <div class="slds-col slds-text-title_bold slds-p-bottom_x-small">
              <span class="slds-text-title_bold slds-p-bottom_x-small">Available Plans</span>
            </div>
            <template for:each={memberPlans} for:item="memberPlan">
              <li key={memberPlan.Id} class="slds-split-view__list-item" data-id={memberPlan.Id}
                onclick={selectMemberPlan} role="presentation" style="border: 1px #ccc solid;">
                <div class="slds-split-view__list-item-action slds-grow slds-has-flexi-truncate" aria-selected="true"
                  tabindex="0" role="option">

                  <div class="slds-p-bottom_small">
                    <div class="slds-col">
                      <span>{memberPlan.Member.FirstName} {memberPlan.Member.LastName} -- Member Plan</span>
                    </div>
                    <div class="slds-col">

                      <span>Member Number: {memberPlan.MemberNumber}</span>

                    </div>
                    <div class="slds-col">
                      <span>Group Number: {memberPlan.GroupNumber}</span>
                    </div>
                    <div class="slds-col">
                      <span>Effective from: {memberPlan.EffectiveFrom}</span>
                    </div>
                    <div class="slds-col">
                      <span>Plan Type: {memberPlan.Service_Detail__r.Service_Type__c}</span>
                    </div>
                    <div class="slds-col">
                      <span>Relationship to Subscriber: {memberPlan.RelationshipToSubscriber}</span>
                    </div>
                  </div>
                </div>
              </li>
            </template>
          </section>
        </template>
      </div>
      <div class="slds-col slds-size_2-of-3">
        <template if:true={selectedMemberPlan.Member}>
          <div class="slds-col slds-size_1-of-3">
            <span class="slds-text-heading_medium slds-p-right_x-small memberPlanName">
              {selectedMemberPlan.Member.FirstName} {selectedMemberPlan.Member.LastName} -- Member Plan
            </span>
            <template if:true={selectedCBVRecord.RequestDate}><span class="slds-badge">Active Coverage as of:
                {truncatedDate}</span></template>
          </div>
          <div class="slds-col slds-size_2-of-3">
            <button class="slds-button slds-button_outline-brand">Verify Benefits</button>
          </div>
          <div class="slds-col slds-size_3-of-3">
            <template if:true={cbvrExist}>
              <label for="request-select" class="slds-form-element__label">Select Previous Request</label>
              <select id="request-select" class="slds-select" onload={handleLoad} onchange={handleChange}>
                <!--onchange={handleSelect}-->
                <template for:each={cbvRecords} for:item="rec">
                  <option key={rec.Id} value={rec.Id}>
                    {rec.Status} — {rec.RequestDate} - Verfication Request
                  </option>
                </template>
              </select>
              <div class="slds-box verification-history slds-m-top_small">
                <template if:true={selectedCBVRecord.Id}>
                  <div class="slds-grid slds-grid_align-space slds-m-top_small">
                    <div class="slds-col"><span>Verification Request</span><br>
                      {selectedCBVRecord.Name}
                    </div>

                    <div class="slds-col"><span>Request Date</span><br>
                      {truncatedDate}
                    </div>
                    <div class="slds-col"><span>Status</span><br>
                      {selectedCBVRecord.Status}
                    </div>
                    <div class="slds-col"><span>Status Reason</span><br>
                      {selectedCBVRecord.StatusReason}
                    </div>
                  </div>
                </template>
              </div>
            </template>
            <div class="slds-m-top_small">

              <lightning-tabset>
                <lightning-tab label="Plan Level Benefits">
                  <template if:true={coverageBenefits}>
                    <lightning-accordion allow-multiple-sections-open active-section-name="Out-Of-Pocket">
                      <lightning-accordion-section name="Out-Of-Pocket" label="Out-Of-Pocket"
                        style="background: #f5f2f2;">
                        <div class="slds-grid slds-gutters_none">
                          <h2>INDIVIDUAL</h2>
                          <div class="slds-col">
                            <h3>In-Network Out-of-Pocket</h3><br>
                             <lightning-progress-bar value={individualInNetworkOutofPocketPercentage} size="small"></lightning-progress-bar>
                            <div class="slds-grid slds-gutters_none">
                             
                              <div class="slds-col">
                                <template if:true={individualInNetworkOutofPocketApplied}>
                                  
                                  <p class="slds-text-align_left">${individualInNetworkOutofPocketApplied} of
                                    ${individualInNetworkOutofPocketLimit} applied</p>
                                </template>
                              </div>
                              <div class="slds-col">
                                <template if:true={individualInNetworkOutofPocketRemaining}>
                                  <p class="slds-text-align_right">
                                    ${individualInNetworkOutofPocketRemaining} remaining
                                  </p>
                                </template>
                              </div>
                            </div>
                          </div>
                          <div class="slds-col">
                            <h2>Out-of-Network Out-of-Pocket</h2>
                             <lightning-progress-bar value={individualInNetworkOutofPocketPercentage}
                                    size="small"></lightning-progress-bar>
                            <div class="slds-grid slds-gutters_none">
                              <div class="slds-col">
                                <template if:true={individualOutofNetworkOutofPocketApplied}>
                                 
                                  <p class="slds-text-align_left">${individualOutofNetworkOutofPocketApplied} of
                                    ${individualOutofNetworkOutofPocketLimit} applied</p>
                                </template>
                              </div>
                              <div class="slds-col">
                                <template if:true={individualOutofNetworkOutofPocketRemain}>
                                  <p class="slds-text-align_right">
                                    ${individualOutofNetworkOutofPocketRemain} remaining
                                  </p>
                                </template>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="slds-grid">
                          <span>FAMILY</span>
                          <div class="slds-col"></div>
                          <div class="slds-col"></div>
                        </div>
                      </lightning-accordion-section>

                      <lightning-accordion-section name="Coinsurance" label="Coinsurance" class="slds-m-top_small"
                        style="background: #f5f2f2;">
                        <div class="slds-grid">
                          <div class="slds-col"></div>
                          <div class="slds-col"></div>
                        </div>
                      </lightning-accordion-section>

                      <lightning-accordion-section name="Copay" label="Copay" class="slds-m-top_small"
                        style="background: #f5f2f2;">
                        <div class="slds-grid">
                          <div class="slds-col"></div>
                          <div class="slds-col"></div>
                        </div>
                        <div class="slds-grid">
                          <div class="slds-col"></div>
                          <div class="slds-col"></div>
                        </div>
                      </lightning-accordion-section>
                      <lightning-accordion-section name="Deductible" label="Deductible" class="slds-m-top_small"
                        style="background: #f5f2f2;">
                        <div class="slds-grid">
                          <div class="slds-col"></div>
                          <div class="slds-col"></div>
                        </div>
                        <div class="slds-grid">
                          <div class="slds-col"></div>
                          <div class="slds-col"></div>
                        </div>
                      </lightning-accordion-section>
                      <lightning-accordion-section name="Lifetime Maximum" label="Lifetime Maximum"
                        class="slds-m-top_small" style="background: #f5f2f2;">
                        <div class="slds-grid">
                          <div class="slds-col"></div>
                          <div class="slds-col"></div>
                        </div>
                      </lightning-accordion-section>
                      <lightning-accordion-section name="Additional Benefit Details" label="Additional Benefit Details"
                        class="slds-m-top_small" style="background: #f5f2f2;">
                        <div class="slds-grid">
                          <div class="slds-col"></div>
                          <div class="slds-col"></div>
                        </div>
                      </lightning-accordion-section>
                    </lightning-accordion>
                  </template>
                </lightning-tab>
                <lightning-tab label="Coverage Benefit Details">
                   <label for="request-select" class="slds-form-element__label">Please select a category to view benefit details</label>
                  <select id="item-request-select" class="slds-select" >
                    <!--onload={handleLoad} onchange={handleChange} add back later-->
                    <template for:each={cbvRecords} for:item="rec">
                      <option key={rec.Id} value={rec.Id}>
                        {rec.Status} — {rec.RequestDate} - Verfication Request
                      </option>
                    </template>
                     <lightning-accordion allow-multiple-sections-open
                         onsectiontoggle={handleSectionToggle}
                         active-section-name={activeSections}>
                        <lightning-accordion-section name="Coverage Benefit Details" label="Coverage Benefit Details">
                            <p>This is the content area for section A.</p>
                            <p>Donec vitae tellus egestas, faucibus ipsum ac, imperdiet erat. Nam venenatis non ante at sagittis. Integer vel purus eget nunc semper placerat. Nam tristique quam leo, et posuere enim condimentum quis. Ut sagittis libero id lectus tempor maximus. Nunc ut tincidunt eros, a hendrerit leo. Suspendisse quis fermentum dolor. Nulla euismod consectetur leo, id condimentum nunc consequat quis.</p>
                        </lightning-accordion-section>
                      </lightning-accordion>
                  </select>
                </lightning-tab>
              </lightning-tabset>

            </div>
          </div>
        </template>
        <template if:false={selectedMemberPlan.Member}>
          <h1>Please select a Member Plan</h1>
        </template>
      </div>
    </div>


  </div>


</template>